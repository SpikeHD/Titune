"use strict";(()=>{function g(){return new URLSearchParams(window.location.search).get("name")}function l(){return new URLSearchParams(window.location.search).get("id")}var m=["AUDIO_QUALITY_ULTRALOW","AUDIO_QUALITY_LOW","AUDIO_QUALITY_MEDIUM","AUDIO_QUALITY_HIGH"],$={invidiousInstance:"https://vid.puffyan.us/",shaders:!0,volume:50,preferredCodec:"mp4a",maxQuality:"AUDIO_QUALITY_HIGH"};function c(){let t=localStorage.getItem("options");return t?JSON.parse(t):$}function E(t,o){let e=c();e[t]=o,localStorage.setItem("options",JSON.stringify(e))}var v=[];async function I(t){if(v.length>0)return v;let o=c().invidiousInstance,e=o.endsWith("/")?o:o+"/",n=await fetch(`${e}api/v1/playlists/${t}`).then(s=>s.json());return v.push(...n.videos),n.videos}async function P(t){let o=c().invidiousInstance,e=o.endsWith("/")?o:o+"/";return(await fetch(`${e}api/v1/videos/${t}`).then(s=>s.json())).adaptiveFormats.filter(s=>s.type.startsWith("audio/"))}async function L(t){let o=await P(t),{preferredCodec:e}=c(),n=o.filter(i=>i.type.includes(e));return k(n)||n[0]||o[0]}function k(t){let{maxQuality:o}=c(),e=m.filter(s=>m.indexOf(s)<=m.indexOf(o)).sort((s,i)=>m.indexOf(s)-m.indexOf(i));return t.find(s=>e.some(i=>s.audioQuality.includes(i)))}async function S(t){let o=await I(t),e=A(t),n=Date.now()/1e3,s=o.reduce((d,a)=>d+a.lengthSeconds,0),i=Math.floor(n/s)+e;return q(o,i)}function q(t,o){let e=[...t];for(let n=e.length-1;n>0;n--){let s=Math.floor((o+n)%(n+1)),i=e[n];e[n]=e[s],e[s]=i}return e}function A(t){let o=0;for(let e=0;e<t.length;e++)o+=t.charCodeAt(e);return o}async function f(t){let o=await S(t),e=Date.now(),n=0;for(let r of o)n+=r.lengthSeconds;let s=Math.floor(e/1e3%n),i=0,d;for(let r of o)if(i+=r.lengthSeconds,s<i){d=r;break}let a=s-(i-d.lengthSeconds);return{song:d,elapsed:a}}async function O(t,o){let e=await S(t),n=await f(t),s=e.findIndex(i=>i.videoId===n.song?.videoId);return s+=o,s%=e.length,e[s]}async function y(t,o){let e=document.getElementById("radio-audio"),n=await L(t.videoId);e.src=n.url,e.currentTime=o,e.play();let s=await O(l(),1),i=await L(s.videoId);await D(i)}async function B(){let t=document.getElementById("radio-audio"),{volume:o}=c();t.volume=o/100}async function D(t){console.log("Caching next song: ",t.url);let o=document.createElement("audio");o.src=t.url,o.preload="metadata";let e=document.body.appendChild(o);e.addEventListener("loadeddata",()=>{e.remove()})}document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("add-open"),o=document.getElementById("add-close");t.addEventListener("click",()=>{let e=document.getElementById("playlist-input"),n=document.getElementById("radio-name-input"),s=e.value;if(!s)return;let a=new URL(s).searchParams.get("list")??s;window.location.search=`?id=${a}&name=${n.value}`}),o.addEventListener("click",()=>{_("add-dialog")})});function M(t){document.getElementById(t).showModal()}function _(t){document.getElementById(t).close()}function p(t){let o=document.getElementById("radio-audio"),e=document.querySelector("#volume-bar"),n=e.querySelectorAll(".volume-bar-line"),s=document.querySelector("#volume-number");t<0&&(t=0),t>100&&(t=100),t>0?e.classList.remove("muted"):e.classList.add("muted"),o.volume=t/100;let i=Math.round(t/(100/n.length))*(100/n.length);n.forEach(d=>d.classList.remove("active"));for(let d=0;d<i/(100/n.length);d++)n[d].classList.add("active");s.textContent=`${t}%`,E("volume",t)}function b(){let t=async()=>{let{song:o,elapsed:e}=await f(l());y(o,e),document.removeEventListener("click",t)};document.addEventListener("click",t)}document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector("#volume-bar");t.addEventListener("click",n=>{let i=Math.floor(n.offsetX/t.clientWidth*100);p(i)}),t.addEventListener("mousedown",n=>{let i=Math.floor(n.offsetX/t.clientWidth*100);p(i),document.addEventListener("mousemove",o),document.addEventListener("mouseup",e)});let o=n=>{let s=n;if(s.target!==t)return;let i=Math.floor(s.offsetX/t.clientWidth*100);p(i)},e=()=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e)}});if(l()&&g()){let t=g(),o=document.querySelectorAll('meta[name*="title"]'),e=document.querySelectorAll('meta[name*="description"]');for(let n of o)n.setAttribute("content","Titune");for(let n of e)n.setAttribute("content",`Listen along to "${t}" Radio`)}document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("add-icon").addEventListener("click",()=>{M("add-dialog")});let o=document.getElementById("currently-playing"),e=document.getElementById("time-elapsed"),n=document.getElementById("duration"),s=document.getElementById("cover"),i=l(),d="",a=g();document.title=`Titune | ${a}`,B(),p(0),b(),await I(i),setInterval(async()=>{let{song:r,elapsed:u}=await f(i);if(!d.includes(r?.title??"Unknown")&&r){let h=(r.videoThumbnails.length>0&&Array.isArray(r.videoThumbnails[0])?r.videoThumbnails[0]:r.videoThumbnails).reduce((x,w)=>w.width>x.width?w:x).url;s.setAttribute("src",h);let T=document.getElementById("bg-cover");T.style.backgroundImage=`url(${h})`,document.getElementById("favicon").setAttribute("href",h),y(r,u)}if(`${r?.title??"Unknown"}${u}`===d)return;o.textContent=r?.title??"Unknown",e.textContent=`${Math.floor(u/60)}:${Math.floor(u%60).toString().padStart(2,"0")}`,n.textContent=`${Math.floor((r?.lengthSeconds??0)/60)}:${Math.floor((r?.lengthSeconds??0)%60).toString().padStart(2,"0")}`;let C=document.getElementById("progress-bar-fill"),U=u/(r?.lengthSeconds??1)*100;C.style.width=`${U}%`,d=`${r?.title??"Unknown"}${u}`},200)});})();
//# sourceMappingURL=bundle.js.map
