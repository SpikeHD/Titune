"use strict";(()=>{function p(){return new URLSearchParams(window.location.search).get("name")}function m(){return new URLSearchParams(window.location.search).get("id")}var u=["AUDIO_QUALITY_ULTRALOW","AUDIO_QUALITY_LOW","AUDIO_QUALITY_MEDIUM","AUDIO_QUALITY_HIGH"],T={invidiousInstance:"https://vid.puffyan.us/",shaders:!0,volume:50,preferredCodec:"mp4a",maxQuality:"AUDIO_QUALITY_HIGH"};function c(){let t=localStorage.getItem("options");return t?JSON.parse(t):T}function S(t,e){let o=c();o[t]=e,localStorage.setItem("options",JSON.stringify(o))}var y=[];async function h(t){if(y.length>0)return y;let e=c().invidiousInstance,o=e.endsWith("/")?e:e+"/",n=await fetch(`${o}api/v1/playlists/${t}`).then(i=>i.json());return y.push(...n.videos),n.videos}async function P(t){let e=c().invidiousInstance,o=e.endsWith("/")?e:e+"/";return(await fetch(`${o}api/v1/videos/${t}`).then(i=>i.json())).adaptiveFormats.filter(i=>i.type.startsWith("audio/"))}async function v(t){let e=await P(t),{preferredCodec:o}=c(),n=e.filter(s=>s.type.includes(o));return k(n)||n[0]||e[0]}function k(t){let{maxQuality:e}=c(),o=u.filter(i=>u.indexOf(i)<=u.indexOf(e)).sort((i,s)=>u.indexOf(i)-u.indexOf(s));return t.find(i=>o.some(s=>i.audioQuality.includes(s)))}async function I(t){let e=await h(t),o=w(t),n=Date.now()/1e3,i=e.reduce((d,a)=>d+a.lengthSeconds,0),s=Math.floor(n/i)+o;return q(e,s)}function q(t,e){let o=[...t];for(let n=o.length-1;n>0;n--){let i=Math.floor((e+n)%(n+1)),s=o[n];o[n]=o[i],o[i]=s}return o}function w(t){let e=0;for(let o=0;o<t.length;o++)e+=t.charCodeAt(o);return e}async function L(t){let e=await I(t),o=Date.now(),n=0;for(let r of e)n+=r.lengthSeconds;let i=Math.floor(o/1e3%n),s=0,d;for(let r of e)if(s+=r.lengthSeconds,i<s){d=r;break}let a=i-(s-d.lengthSeconds);return{song:d,elapsed:a}}async function A(t,e){let o=await I(t),n=await L(t),i=o.findIndex(s=>s.videoId===n.song?.videoId);return i+=e,i%=o.length,o[i]}async function B(t,e){let o=document.getElementById("radio-audio"),n=await v(t.videoId);o.src=n.url,o.currentTime=e,o.play();let i=await A(m(),1),s=await v(i.videoId);await D(s)}async function O(){let t=document.getElementById("radio-audio"),{volume:e}=c();t.volume=e/100}async function D(t){console.log("Caching next song: ",t.url);let e=document.createElement("audio");e.src=t.url,e.preload="metadata";let o=document.body.appendChild(e);o.addEventListener("loadeddata",()=>{o.remove()})}document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("add-open"),e=document.getElementById("add-close");t.addEventListener("click",()=>{let o=document.getElementById("playlist-input"),n=document.getElementById("radio-name-input"),i=o.value;if(!i)return;let a=new URL(i).searchParams.get("list")??i;window.location.search=`?id=${a}&name=${n.value}`}),e.addEventListener("click",()=>{_("add-dialog")})});function M(t){document.getElementById(t).showModal()}function _(t){document.getElementById(t).close()}function f(t){let e=document.getElementById("radio-audio"),o=document.querySelector("#volume-bar"),n=o.querySelectorAll(".volume-bar-line"),i=document.querySelector("#volume-number");t<0&&(t=0),t>100&&(t=100),t>0?o.classList.remove("muted"):o.classList.add("muted"),e.volume=t/100;let s=Math.round(t/(100/n.length))*(100/n.length);n.forEach(d=>d.classList.remove("active"));for(let d=0;d<s/(100/n.length);d++)n[d].classList.add("active");i.textContent=`${t}%`,S("volume",t)}function b(){let t=()=>{document.getElementById("radio-audio").play(),document.removeEventListener("click",t)};document.addEventListener("click",t)}document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector("#volume-bar");t.addEventListener("click",n=>{let s=Math.floor(n.offsetX/t.clientWidth*100);f(s)}),t.addEventListener("mousedown",n=>{let s=Math.floor(n.offsetX/t.clientWidth*100);f(s),document.addEventListener("mousemove",e),document.addEventListener("mouseup",o)});let e=n=>{let i=n;if(i.target!==t)return;let s=Math.floor(i.offsetX/t.clientWidth*100);f(s)},o=()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",o)}});if(m()&&p()){let t=p(),e=document.querySelectorAll('meta[name*="title"]'),o=document.querySelectorAll('meta[name*="description"]');for(let n of e)n.setAttribute("content","Titune");for(let n of o)n.setAttribute("content",`Listen along to "${t}" Radio`)}document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("add-icon").addEventListener("click",()=>{M("add-dialog")});let e=document.getElementById("currently-playing"),o=document.getElementById("time-elapsed"),n=document.getElementById("duration"),i=document.getElementById("cover"),s=m(),d="",a=p();document.title=`Titune | ${a}`,O(),f(0),b(),await h(s),setInterval(async()=>{let{song:r,elapsed:l}=await L(s);if(!d.includes(r?.title??"Unknown")&&r){let g=(r.videoThumbnails.length>0&&Array.isArray(r.videoThumbnails[0])?r.videoThumbnails[0]:r.videoThumbnails).reduce((x,E)=>E.width>x.width?E:x).url;i.setAttribute("src",g);let $=document.getElementById("bg-cover");$.style.backgroundImage=`url(${g})`,document.getElementById("favicon").setAttribute("href",g),B(r,l)}if(`${r?.title??"Unknown"}${l}`===d)return;e.textContent=r?.title??"Unknown",o.textContent=`${Math.floor(l/60)}:${Math.floor(l%60).toString().padStart(2,"0")}`,n.textContent=`${Math.floor((r?.lengthSeconds??0)/60)}:${Math.floor((r?.lengthSeconds??0)%60).toString().padStart(2,"0")}`;let U=document.getElementById("progress-bar-fill"),C=l/(r?.lengthSeconds??1)*100;U.style.width=`${C}%`,d=`${r?.title??"Unknown"}${l}`},200)});})();
//# sourceMappingURL=bundle.js.map
